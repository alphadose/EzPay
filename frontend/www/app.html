<!doctype html>
<html class="no-js h-100" lang="en">

<head>
  <meta charset="utf-8">
  <!-- <meta http-equiv="Content-Security-Policy"
    content="default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *"> -->
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Shards Dashboard Lite - Free Bootstrap Admin Template – DesignRevision</title>
  <meta name="description"
    content="A high-quality &amp; free Bootstrap admin dashboard template pack that comes with lots of templates and components.">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <link rel="stylesheet" id="main-stylesheet" data-version="1.1.0" href="styles/shards-dashboards.1.1.0.min.css">
  <link rel="stylesheet" href="styles/extras.1.1.0.min.css">
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.6/quill.snow.css">
  <link rel="stylesheet" href="styles/sin_styles.css">
</head>

<body style="height: 100vh;">
  <div class="container-fluid">
    <div class="row">
      <!-- Main Sidebar -->
      
      <main class="main-content col-lg-10 col-md-9 col-sm-12 p-0 offset-lg-2 offset-md-3">
        <div class="main-navbar sticky-top bg-white">
          <!-- Main Navbar -->
          <nav class="navbar align-items-stretch navbar-light flex-md-nowrap p-0">
            <form action="#" class="main-navbar__search w-100 d-none d-md-flex d-lg-flex">
              <div class="input-group input-group-seamless ml-3">
                <div class="input-group-prepend">
                  <div class="input-group-text">
                    <i class="fas fa-search"></i>
                  </div>
                </div>
                <input class="navbar-search form-control" type="text" placeholder="Search for something..."
                  aria-label="Search">
              </div>
            </form>
            <ul class="navbar-nav border-left flex-row ">
              <li class="nav-item border-right dropdown notifications">
                <a class="nav-link nav-link-icon text-center" href="#" role="button" id="dropdownMenuLink"
                  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <div class="nav-link-icon__wrapper">
                    <i class="material-icons">&#xE7F4;</i>
                    <span class="badge badge-pill badge-danger">2</span>
                  </div>
                </a>
                <div class="dropdown-menu dropdown-menu-small" aria-labelledby="dropdownMenuLink">
                  <a class="dropdown-item" href="#">
                    <div class="notification__icon-wrapper">
                      <div class="notification__icon">
                        <i class="material-icons">&#xE6E1;</i>
                      </div>
                    </div>
                    <div class="notification__content">
                      <span class="notification__category">Analytics</span>
                      <p>Your website’s active users count increased by
                        <span class="text-success text-semibold">28%</span> in the last week. Great job!</p>
                    </div>
                  </a>
                  <a class="dropdown-item" href="#">
                    <div class="notification__icon-wrapper">
                      <div class="notification__icon">
                        <i class="material-icons">&#xE8D1;</i>
                      </div>
                    </div>
                    <div class="notification__content">
                      <span class="notification__category">Sales</span>
                      <p>Last week your store’s sales count decreased by
                        <span class="text-danger text-semibold">5.52%</span>. It could have been worse!</p>
                    </div>
                  </a>
                  <a class="dropdown-item notification__all text-center" href="#"> View all Notifications </a>
                </div>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle text-nowrap px-3" data-toggle="dropdown" href="#" role="button"
                  aria-haspopup="true" aria-expanded="false">
                  <img class="user-avatar rounded-circle mr-2" src="images/avatars/0.jpg" alt="User Avatar">
                  <span class=" d-md-inline-block">Alphadose</span>
                </a>
                <div class="dropdown-menu dropdown-menu-small">
                  <a class="dropdown-item" href="user-profile-lite.html">
                    <i class="material-icons">&#xE7FD;</i> Profile</a>
                  <a class="dropdown-item" href="components-blog-posts.html">
                    <i class="material-icons">vertical_split</i> Blog Posts</a>
                  <a class="dropdown-item" href="add-new-post.html">
                    <i class="material-icons">note_add</i> Add New Post</a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item text-danger" href="#">
                    <i class="material-icons text-danger">&#xE879;</i> Logout </a>
                </div>
              </li>
            </ul>
            <nav class="nav">
              <a href="#" class="nav-link nav-link-icon toggle-sidebar d-md-inline d-lg-none text-center border-left"
                data-toggle="collapse" data-target=".header-navbar" aria-expanded="false" aria-controls="header-navbar">
                <i class="material-icons">&#xE5D2;</i>
              </a>
            </nav>
          </nav>
        </div>
        <!-- / .main-navbar -->
        <div class="main-content-container container-fluid px-4 mb-4">
          <!-- Page Header -->
          <div class="page-header row no-gutters py-4 mb-5">
            <div class="col-12 col-sm-4 text-center text-sm-left mb-0">
              <h3 class="page-title mt-4 mb-2">EzPay</h3>
              <span class="text-uppercase page-subtitle">Payments simplified</span>
            </div>
          </div>
          <!-- End Page Header -->
          <div class="row mb-2 mt-5">
            <div onclick="openVpa()" class="col">
              <div class="bg-primary rounded text-white text-center p-3"
                style="box-shadow: inset 0 0 5px rgba(0,0,0,.2);"><br><i class="fas fa-at fa-5x"></i><br><br>
                <h5 style="color: white;">Pay via VPA</h5>
              </div>
            </div>
            <div class="col">
              <div onclick="scan()" class="bg-primary rounded text-white text-center p-3"
                style="box-shadow: inset 0 0 5px rgba(0,0,0,.2);"><br><i class="fas fa-qrcode fa-5x"></i><br><br>
                <h5 style="color: white;">Pay via QR</h5>
              </div>
            </div>
          </div>
          <div class="row center mb-2 mt-5">
            <div onclick="openMobile()" class="col">
              <div class="bg-primary rounded text-white text-center p-3"
                style="box-shadow: inset 0 0 5px rgba(0,0,0,.2);"><br><i class="fas fa-mobile fa-5x"></i><br><br>
                <h5 style="color: white;">Pay via Mobile Number</h5>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>
  <div class="modal fade" style="height: 100vh !important;" id="myModal" tabindex="-1" role="dialog"
    aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="height:600px;" role="document">
      <div class="modal-content" style="height:600px;">
        <div class="modal-header mb-5">
          <h5 class="modal-title" id="exampleModalLabel">1 Time Registration</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body mt-5">

          <div class="form-group">
            <div class="input-group mb-3">

              <div class="row w-100">
                <div class="col-6 input-group-prepend w-100">
                  <span class="input-group-text w-100" id="basic-addon1">VPA</span>
                </div>
                <div class="col-6 input-group-prepend w-100">
                  <input id="vpa" type="text" class="form-control w-100" placeholder="weeb@oksbi" aria-label="Username"
                    aria-describedby="basic-addon1">
                </div>
              </div>
            </div>
          </div>

          <div class="form-group">
            <div class="input-group mb-3">

              <div class="row w-100">
                <div class="col-6 input-group-prepend w-100">
                  <span class="input-group-text w-100" id="basic-addon1">IFSC code</span>
                </div>
                <div class="col-6 input-group-prepend w-100">
                  <input id='ifsc' type="text" class="form-control w-100" placeholder="HDFC0022" aria-label="Username"
                    aria-describedby="basic-addon1">
                </div>
              </div>
            </div>
          </div>


          <div class="form-group">
            <div class="input-group mb-3">

              <div class="row w-100">
                <div class="col-6 input-group-prepend w-100">
                  <span class="input-group-text w-100" id="basic-addon1">Account number</span>
                </div>
                <div class="col-6 input-group-prepend w-100">
                  <input id='acc' type="text" class="form-control w-100" placeholder="1122AA99DD00"
                    aria-label="Username" aria-describedby="basic-addon1">
                </div>
              </div>
            </div>
          </div>
          <div class="form-group">
            <div class="input-group mb-3">

              <div class="row w-100">
                <div class="col-6 input-group-prepend w-100">
                  <span class="input-group-text w-100" id="basic-addon1">Account TYPE</span>
                </div>
                <div class="col-6 input-group-prepend w-100">
                  <select id="type" class="form-control">
                    <option selected="">SAVINGS</option>
                    <option>CURRENT</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer justify-content-center">
          <button type="button" onclick="updateLocal()" data-dismiss="modal" class="btn btn-primary">Save</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="pinModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="paying">Paying- </h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">

          <div class="form-group">
            <div class="input-group mb-3">

              <div class="row w-100">
                <div class="col-5 input-group-prepend w-100">
                  <span class="input-group-text w-100" id="basic-addon1">Rs.</span>
                </div>
                <div class="col-7 input-group-prepend w-100">
                  <input class="form-control" id="amt" pattern="[0-9]*" inputmode="numeric">
                </div>
              </div>
            </div>
          </div>

          <div class="form-group">
            <div class="input-group mb-3">

              <div class="row w-100">
                <div class="col-5 input-group-prepend w-100">
                  <span class="input-group-text w-100" id="basic-addon1">PIN</span>
                </div>
                <div class="col-7 input-group-prepend w-100">
                  <input type="password" class="form-control" id="pin" inputmode="numeric">
                </div>
              </div>
            </div>
          </div>
        </div>
        <div style="position: relative;" class="modal-footer justify-content-center">
          <div class="circle-loader smooth">
            <div class="checkmark draw"></div>
          </div>
          <button type="button" class="btn btn-primary smooth" id="donePin" onclick="donePin()"
            data-dismiss="modal1">Continue</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="mobileModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalCenterTitle">Recipient's Mobile</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">

          <div class="form-group">
            <div class="input-group mb-3">

              <div class="row w-100">
                <div class="col-5 input-group-prepend w-100">
                  <span class="input-group-text w-100" id="basic-addon1">Mobile No</span>
                </div>
                <div class="col-7 input-group-prepend w-100">
                  <input class="form-control" id="mobile" pattern="[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]"
                    inputmode="numeric">
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer justify-content-center">
          <button type="button" class="btn btn-primary" onclick="doneMobile()" data-dismiss="modal">Continue</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="vpaModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalCenterTitle">Recipient's VPA</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">

          <div class="form-group">
            <div class="input-group mb-3">

              <div class="row w-100">
                <div class="col-5 input-group-prepend w-100">
                  <span class="input-group-text w-100" id="basic-addon1">VPA</span>
                </div>
                <div class="col-7 input-group-prepend w-100">
                  <input class="form-control" id="recVpa">
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer justify-content-center">
          <button type="button" class="btn btn-primary" onclick="doneVpa()" data-dismiss="modal">Done</button>
        </div>
      </div>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
  <script src="https://unpkg.com/shards-ui@latest/dist/js/shards.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sharrre/2.0.1/jquery.sharrre.min.js"></script>
  <script src="scripts/extras.1.1.0.min.js"></script>
  <script src="scripts/shards-dashboards.1.1.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.6/quill.min.js"></script>
  <script src="scripts/app/app-blog-new-post.1.1.0.js"></script>
  <script src="scripts/jsencrypt.min.js"></script>
  <script type="text/javascript" src="cordova.js"></script>
  <script type="text/javascript" src="config.js"></script>



  <script>


    var crypt = new JSEncrypt();
    crypt.setKey(pubKey);
    console.log(crypt.encrypt('lol'))

    var details
    localStorage.clear();
    if (localStorage.getItem("details") == null) {
      $("#myModal").modal()
    }
    else {
      details = JSON.parse(localStorage.getItem("details"))
    }

    function updateLocal() {
      details = {
        vpa: $("#vpa").val(),
        ifsc: $("#ifsc").val(),
        acc: $("#acc").val(),
        type: $("#type option:selected").text()
      }
      console.log(details)
      localStorage.setItem("details", JSON.stringify(details));

    }
    var recipient
    var recVpa
    function extractRecipient(str) {
      recipient = Array();
      let vpa = (str.split('pa=')[1]).split('&pn=')[0];
      recipient["vpa"] = vpa;
      recVpa = vpa;
      console.log(vpa)
    }

    function askPin() {
      setTimeout(function () {
        openPin()
      }, 400)
    }
    function openPin() {
      addPaying()
      $("#pinModal").modal()
    }
    var pin
    var amt
    function donePin() {
      pin = $("#pin").val()
      amt = $("#amt").val()
      sendMoney()
      $("#donePin").toggleClass("fadeout");
      $(".circle-loader").toggleClass("fadein");
      // $('.circle-loader').toggleClass('load-complete');
      // $('.checkmark').toggle();


      document.addEventListener('onSMSArrive', function (e) {
        console.log('onSMSArrive()');
        var IncomingSMS = e.data;
        console.log('sms.address:' + IncomingSMS.address);
        console.log('sms.body:' + IncomingSMS.body);

        SMSReceive.stopWatch(function() {
					console.log('SMS Watching stopped');
				}, function() {
					console.log('Plugin failed to stop watching');
				});

        $('.circle-loader').toggleClass('load-complete');
        $('.checkmark').toggle();
        setTimeout(function () {
          $("#pinModal").modal()
        }, 700)
        // Debug received SMS contents as JSON
      });

      SMSReceive.startWatch(function () {
        console.log('SMS Watching started');
      }, function () {
        console.log('Plugin failed to start watching');
      });

    }

    function openMobile() {
      $("#mobileModal").modal()
    }

    function openVpa() {
      $("#vpaModal").modal()
    }

    function doneMobile() {
      mobile = $('#mobile').val()
      askPin()
    }
    var mobile

    function doneVpa() {
      recVpa = $('#recVpa').val()
      console.log(recVpa)
      askPin()
    }
    function addPaying() {
      let adding;
      console.log(mobile, recVpa)
      if (typeof mobile !== 'undefined') {
        adding = mobile
      }
      else {
        adding = recVpa
      }
      $('#paying').append(adding)
    }

    function checkVar(e) {
      if (typeof e !== 'undefined') {
        return ''
      }
      else {
        return e
      }
    }

    function sendMoney() {
      // paymentDetails = {
      //   payer_address: "alpha@dose",
      //   recipient_address: "manasu@weaboo",
      //   amount: 6969,
      //   pin: 91169,
      //   recipient_phone: "+919438440614", //only one of this or payer_address would be set
      //   ifsc_code: "SBIN696969",
      //   account_type: "CURRENT",
      //   account_number: 30617312009
      // }
      // Now do this shit
      //if (typeof recipient !== 'undefined') {
      let paymentDetails = {
        payer_address: details.vpa,
        recipient_address: recVpa,
        amount: amt,
        pin: pin,
        recipient_phone: mobile, //only one of this or payer_address would be set
        ifsc_code: details.ifsc,
        account_type: details.type,
        account_number: details.acc
      };
      let toSend = JSON.stringify(paymentDetails);
      console.log(toSend.substring(0, 100))
      console.log(toSend.substring(100))
      sendSMS("+14109819498", crypt.encrypt(toSend.substring(0, 100)) + ' ' + crypt.encrypt(toSend.substring(100)))

    }

    function scan() {
      cordova.plugins.barcodeScanner.scan(
        function (result) {
          if (!result.cancelled) {
            if (result.format == "QR_CODE") {
              console.log(result.text);
              extractRecipient(result.text);
              askPin();
            }
          }
        },
        function (error) {
          alert("Scanning failed: " + error);
        },
        {
          showTorchButton: true, // iOS and Android
          prompt: "Scan a UPI QR Code", // Android
          resultDisplayDuration: 0, // Android, display scanned text for X ms. 0 suppresses it entirely, default 1500
          formats: "QR_CODE", // default: all but PDF_417 and RSS_EXPANDED
          disableSuccessBeep: false // iOS and Android
        }
      );
    }
    function sendSMS(number, message) {
      //var number = '111111'; /* iOS: ensure number is actually a string */
      //var message = 'Yo Chika!';
      console.log("number=" + number + ", message= " + message);

      //CONFIGURATION
      var options = {
        replaceLineBreaks: false, // true to replace \n by a new line, false by default
        android: {
          intent: 'INTENT'  // send SMS with the native android SMS messaging
          //intent: '' // send SMS without opening any other app
        }
      };

      var success = function () { };
      var error = function (e) { };
      sms.send(number, message, options, success, error);
    }

    function perms() {
      var success = function (hasPermission) {
        console.log(1)
        if (!hasPermission) {
          console.log(2)
          sms.requestPermission(function () {
            console.log(3)
            console.log('[OK] Permission accepted')
            sendSMS();
          }, function (error) {
            console.log(4)
            console.info('[WARN] Permission not accepted')
            // Handle permission not accepted
          })
        }
        else {
          sendSMS();
        }
      };
      var error = function (e) { alert('Something went wrong:' + e); };
      console.log(5);
      sms.hasPermission(success, error);
    }

  </script>
</body>

</html>